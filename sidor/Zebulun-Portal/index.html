<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>Zebulun Delivery Portal – Powered by H.Saban Materials</title>
    
    <!-- PWA Manifest & Theme -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Icons (Feather) -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <!-- Google Font: Rubik -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- App Stylesheets -->
    <!-- Mobile styles load by default -->
    <link rel="stylesheet" href="app.mobile.css">
    <!-- Desktop styles load only on larger screens -->
    <link rel="stylesheet" href="app.desktop.css" media="screen and (min-width: 769px)">

    <style>
      /* Initial loader to prevent flash of unstyled content */
      body { font-family: 'Rubik', sans-serif; }
      .initial-loader {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f0f4f8;
        z-index: 9999;
      }
      .loader-spinner {
        border: 4px solid #e5e9f0;
        border-top: 4px solid #3b82f6;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Initial Page Loader -->
    <div id="initial-loader" class="initial-loader">
        <div class="loader-spinner"></div>
    </div>

    <!-- 
      =====================================================
      DESKTOP CRM LAYOUT (Hidden on mobile by app.mobile.css)
      =====================================================
    -->
    <div id="desktop-crm-layout">
        <!-- 1. HEADER -->
        <header id="app-header">
            <div id="app-branding">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTcYS_xImwWt1fAYIK1UTXHtbCfmt5TOny5UQ&s" alt="לוגו זבולון עדירן">
                <img src="https://i.postimg.cc/ryPT3r29/image.png" alt="לוגו ח.סבן">
                <h1 id="app-title">Zebulun Delivery Portal</h1>
            </div>
            <div id="app-controls">
                <span id="welcome-message-desktop" class="font-medium">טוען...</span>
                <button id="theme-toggle-desktop" class="theme-toggle" title="שנה מצב תצוגה">
                    <i data-feather="sun"></i>
                </button>
            </div>
        </header>

        <!-- 2. LEFT NAVIGATION -->
        <nav id="main-nav">
            <a href="#" class="nav-link active" data-view="new-order">
                <i data-feather="plus-circle"></i>
                <span>הזמנה חכמה (הדבקה)</span>
            </a>
            <a href="#" class="nav-link" data-view="projects">
                <i data-feather="briefcase"></i>
                <span>ניהול פרויקטים</span>
            </a>
            <a href="#" class="nav-link" data-view="orders">
                <i data-feather="truck"></i>
                <span>מעקב הזמנות</span>
            </a>
            <a href="#" class="nav-link" data-view="guide">
                <i data-feather="play-circle"></i>
                <span>הדרכה</span>
            </a>
        </nav>

        <!-- 3. MAIN CONTENT (Center) -->
        <main id="main-content-wrapper">
            <!-- View: Smart Paste (Default) -->
            <div id="new-order-view" class="app-view active">
                <h2 class="section-header">הזמנה חכמה (העתק-הדבק)</h2>
                <div id="smart-paste-box">
                    <p class="form-label">שלום יוסי, הדבק כאן את תוכן ההזמנה שלך:</p>
                    <textarea id="smart-paste-textarea" class="form-textarea" placeholder="הדבק כאן תוכן... לדוגמה:
לקוח: 601524 - זבולון-עדירן/חדד
איש קשר: עבד
טלפון: 050-1234567
פרויקט: וינגייט 27, כפר שמריהו
...
- 10 בלוק 20
- 5 מלט
- מצורף קובץ..."></textarea>
                    
                    <div class="flex gap-4 mt-4">
                        <button id="parse-paste-btn" class="btn btn-secondary">
                            <i data-feather="cpu"></i>
                            <span>נתח והצג תצוגה מקדימה</span>
                        </button>
                         <input type="file" id="file-upload-input" multiple hidden>
                         <button id="file-upload-btn" class="btn btn-secondary">
                             <i data-feather="paperclip"></i>
                             <span>צרף קבצים (0)</span>
                         </button>
                    </div>

                    <div id="parsed-fields-preview" class="hidden">
                        <h3 class="text-lg font-semibold col-span-2">תצוגה מקדימה</h3>
                        <div class="form-group">
                            <label class="form-label">מזהה לקוח:</label>
                            <input type="text" id="parsed-client-id" class="form-input" placeholder="למשל: 601524">
                        </div>
                        <div class="form-group">
                            <label class="form-label">שם פרויקט:</label>
                            <input type="text" id="parsed-project-name" class="form-input" placeholder="למשל: וינגייט 27">
                        </div>
                        <div class="form-group">
                            <label class="form-label">איש קשר:</label>
                            <input type="text" id="parsed-contact-name" class="form-input" placeholder="למשל: יוסי / עבד">
                        </div>
                        <div class="form-group">
                            <label class="form-label">טלפון:</label>
                            <input type="text" id="parsed-contact-phone" class="form-input" placeholder="למשל: 050-1234567">
                        </div>
                    </div>
                    <div id="attachments-preview"></div>
                    
                    <button id="send-order-btn" class="btn btn-primary w-full mt-4">
                        <i data-feather="send"></i>
                        <span>שלח הזמנה</span>
                    </button>
                </div>
            </div>
            
            <!-- View: Projects -->
            <div id="projects-view" class="app-view">
                <h2 class="section-header">ניהול פרויקטים (זבולון עדירן)</h2>
                <div id="projects-grid-desktop" class="projects-grid">
                    <!-- כרטיסי פרויקט יטענו לכאן ע"י JS -->
                    <div class="project-card add-new" id="add-project-btn-desktop">
                        <i data-feather="plus"></i>
                        <span class="ml-2 font-semibold">הוסף פרויקט חדש</span>
                    </div>
                </div>
            </div>
            
            <!-- View: Orders -->
            <div id="orders-view" class="app-view">
                <h2 class="section-header">מעקב הזמנות</h2>
                <div id="orders-list-desktop">
                    <!-- רשימת הזמנות תטען לכאן -->
                </div>
            </div>

            <!-- View: Guide -->
            <div id="guide-view" class="app-view">
                <h2 class="section-header">הדרכה וסרטונים</h2>
                <!-- Placeholder for voice/video guide -->
                <div class="p-4 bg-white rounded-lg border">
                    <p>כאן יוצג סרטון הדרכה...</p>
                </div>
            </div>
        </main>

        <!-- 4. RIGHT DETAILS PANEL -->
        <aside id="details-panel">
            <h2>פרטים</h2>
            <div id="details-content">
                <p class="text-center p-8 text-sm text-gray-500">בחר פריט להצגת פרטים</p>
            </div>
        </aside>
    </div>

    <!-- 
      =====================================================
      MOBILE PWA LAYOUT (Hidden on desktop by app.desktop.css)
      =====================================================
    -->
    <div id="mobile-pwa-layout">
        <!-- 1. HEADER -->
        <header id="app-header">
            <div id="app-branding">
                <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTcYS_xImwWt1fAYIK1UTXHtbCfmt5TOny5UQ&s" alt="לוגו זבולון עדירן">
                <img src="https://i.postimg.cc/ryPT3r29/image.png" alt="לוגו ח.סבן">
            </div>
            <div id="app-controls">
                <button id="theme-toggle-mobile" class="theme-toggle">
                    <i data-feather="sun"></i>
                </button>
            </div>
        </header>

        <!-- 2. MAIN CONTENT -->
        <main id="app-content">
            <!-- View: Dashboard (Projects) -->
            <div id="view-dashboard" class="app-view active">
                <h2 id="welcome-message-mobile" class="section-header">טוען...</h2>
                <div id="projects-grid-mobile" class="projects-grid">
                    <!-- כרטיסי פרויקט יטענו לכאן ע"י JS -->
                    <div class="project-card add-new" id="add-project-btn-mobile">
                        <i data-feather="plus"></i>
                        <span class="ml-2 font-semibold">הוסף פרויקט חדש</span>
                    </div>
                </div>
            </div>

            <!-- View: New Order (Smart Paste) -->
            <div id="view-new-order" class="app-view">
                <h2 class="section-header">הזמנה חדשה (הדבקה)</h2>
                <div id="smart-paste-box-mobile">
                    <textarea id="smart-paste-textarea-mobile" class="form-textarea" placeholder="הדבק כאן תוכן..."></textarea>
                    
                    <div class="flex gap-4 mt-4">
                         <button id="file-upload-btn-mobile" class="btn btn-secondary flex-1">
                             <i data-feather="paperclip"></i>
                             <span>צרף (0)</span>
                         </button>
                        <button id="parse-paste-btn-mobile" class="btn btn-secondary flex-1">
                            <i data-feather="cpu"></i>
                            <span>נתח</span>
                        </button>
                    </div>

                    <div id="parsed-fields-preview-mobile" class="hidden">
                        <!-- שדות שפוענחו יופיעו כאן -->
                    </div>
                    <div id="attachments-preview-mobile"></div>
                    
                    <button id="send-order-btn-mobile" class="btn btn-primary w-full mt-4">
                        <i data-feather="send"></i>
                        <span>שלח הזמנה</span>
                    </button>
                </div>
            </div>
            
            <!-- View: Order Status -->
            <div id="view-status" class="app-view">
                <h2 class="section-header">מעקב הזמנות</h2>
                <div id="orders-list-mobile">
                    <!-- רשימת הזמנות תטען לכאן -->
                </div>
            </div>

            <!-- View: Guide -->
            <div id="view-guide" class="app-view">
                <h2 class="section-header">הדרכה</h2>
                <div id="voice-guide-placeholder" class="p-4 bg-white rounded-lg border text-center">
                    <i data-feather="play-circle" class="w-12 h-12 text-primary-500 mx-auto"></i>
                    <p class="font-semibold mt-2">"היי יוסי, ברוך הבא..."</p>
                    <button class="btn btn-secondary mt-4">צפה בסרטון הדגמה</button>
                </div>
            </div>
        </main>

        <!-- 3. BOTTOM NAVIGATION -->
        <nav id="mobile-nav">
            <button class="nav-button active" data-view="dashboard">
                <i data-feather="briefcase"></i>
                <span>פרויקטים</span>
            </button>
            <button class="nav-button" data-view="new-order">
                <i data-feather="plus-circle"></i>
                <span>הזמנה חדשה</span>
            </button>
            <button class="nav-button" data-view="status">
                <i data-feather="truck"></i>
                <span>מעקב</span>
            </button>
            <button class="nav-button" data-view="guide">
                <i data-feather="help-circle"></i>
                <span>הדרכה</span>
            </button>
        </nav>
    </div>

    <!-- 
      =====================================================
      MODALS & SHARED ELEMENTS
      =====================================================
    -->

    <!-- Project Details/Edit Popup -->
    <div id="project-popup" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="project-popup-title">טוען...</h2>
                <button id="project-popup-close-btn"><i data-feather="x"></i></button>
            </div>
            <div id="project-popup-body">
                <form id="project-details-form">
                    <input type="hidden" id="project-popup-id">
                    <div class="form-group">
                        <label class="form-label">שם פרויקט</label>
                        <input type="text" id="project-popup-name" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">כתובת אספקה (ברירת מחדל)</label>
                        <input type="text" id="project-popup-address" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">איש קשר ראשי</label>
                        <input type="text" id="project-popup-contact" class="form-input">
                    </div>
                    
                    <div class="mt-6 flex flex-col sm:flex-row-reverse gap-3">
                         <button type="submit" class="btn btn-primary">
                             <i data-feather="save"></i>
                             <span>שמור שינויים</span>
                         </button>
                         <button type="button" id="project-popup-new-order-btn" class="btn btn-secondary">
                             <i data-feather="plus"></i>
                             <span>הזמנה לפרויקט זה</span>
                         </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Toast Container (for notifications) -->
    <div id="toast-container"></div>
    
    <!-- Ping Sound Element -->
    <audio id="ping-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
    <audio id="send-sound" src="https://actions.google.com/sounds/v1/device/notifications/notification_simple.ogg" preload="auto"></audio>

    <!-- App Logic -->
    <script type="module" src="app.logic.js"></script>

    <!-- Feather Icons Init -->
    <script>
      feather.replace();
    </script>
</body>
</html>

